# 라우팅 알고리즘
목적 : 최단거리를 찾아서 포워딩 테이블을 만들자                      
라우터를 하나의 정점으로 보고 라우터의 연결을 그래프로 보자     
                
포워딩 : 목적지를 결정(포워딩 테이블을 참조해서) 
라우팅 : 목적지로 이동


### 라우터 그래프가 있는경우(네트워크 상황 KNOW)
1. link state(다익스트라) 알고리즘
2. 모든 라우터가 자신의 정보를 브로드 캐스트 해야 함
3. cost로 판단한다
4. inf는 직접 연결 X
5. 시작은 u로 가정한다
6. N' 에 속한 집합은 이미 최단거리가 확정 된것 
7. 라운드0에서 초기화
8. 라운드1에서 W까지의 거리가 최단거리로 확정이므로 N` = {w}
   1. 그리고 w와 이웃하고 N`에 속하지 않은 정점의 거리를 업데이트 한다.x,y,v
9. 라운드2에서 N' = {w,x}
    1. y,z를 업데이트한다
10. 라운드3에서 N' = {w,x,v} 
    1. y를 업데이트한다
11. 라운드 4에서 N'= {w,x,v,y}
    1. z를 업데이트한다
12. 라운드 5에서 N' = {w,x,v,y,z}로 종료
   
|     | u   | v   | w   | x   | y   | z   |
|-----|-----|-----|-----|-----|-----|-----|
| u   |     | 7   | 3   | 5   | inf | inf |
| v   | 7   |     | 3   | inf | 4   | inf |
| w   | 3   | 3   |     | 4   | 8   | inf |
| x   | 5   | 4   | 4   |     | 7   | 9   |
| y   | inf | 4   | 8   | 7   |     | 2   |
| z   | inf | inf | inf | 9   |  2   |     |



| round | u   | v    | w   | x   | y    | z   |
|-------|-----|-------|------|------|------|-----|
| 0     |    | 7 ,u | 3 ,u | 5, u | inf  | inf | 
| 1     |     | 6,w  | 3,u | 5,u | 11,w | inf |
| 2     |     |  6,w    | 3,u   |  5,u   | 11,w |  14,x   |
| 3     |     |  6,w    | 3,u   |  5,u   | 10,v |  14,x   |
| 4     |     |  6,w    | 3,u   |  5,u   | 10,v |  11,y   |
| 5     |     |  6,w    | 3,u   |  5,u   | 10,v |  11,y   |

| 도착지 | 포워딩 |
|-----|-----|
| v   | w   |
| w   | w   |
| x   | x   |
| y   | w   |
| z   | w   |

13. 현실적으로 이용하려면  전 세계를 대상으로 브로드 캐스트 하는게 아닌 하나의 네트워크 안에서 수행한다.
    1. A대학 B대학 KT 가 있다면 ??
    2. 각 기관의 내부는 라우터로 연결되어 있다.
    3. 그리고 각 기관끼리 무언가로 연결되어 있다.
    4. link state는 하나의 기관 안에서만 발생한다.
    5. 즉 A기관이 ink state를 한다고 해서 B까지 브로드캐스트 하는게 아니다
    6. 그럼 기관끼리는 어떻게 라우팅할까?? => 이는 기관들의 상위 기관에서 해결한다.


### 이웃과의 최단 경로만 구하는 경우 (아직 잘 모르겠음)
1. distance vector 알고리즘(분산처리)
2. 나와 직접적으로 연결된 라우터와만 정보를 교환함
3. d(x)^y : 출발지 x에서 목적지 y까지의 최소 경로 
4. d(x)^y = min(C(x,v) +d(v)^y)
5. x에서 y까지의 직접적인 경로가 없다면 x는 x의 이웃을 거쳐서 y로 간다는 것은 자명하다.
6. x의 이웃이 (a,b,c)이고 a,b,c 모두 y와 직접적으로 연결 되었다면 
   1. d(x)^y = (C(x,a | b | c) + d(a | b | c)^y) 중 최소값이다
   2. 단 여기서 d(x)^y를 어떻게 구할까?? 
   3. 재귀적으로 구한다...
7. u에서 시작한다고 생각하자
8. 자기와 연결된 이웃(v,w)에게 자신의 테이블을 넘겨준다
9. 전달받으면 다시 계산을 하고 이웃에게 전달한다
10. 반복하면 안정화에 도달한다.

T0 시점 

| X테이블 | x   | y   | z   |
|------|-----|-----|-----|
| x    | 0   | 4   | 50  |
| y    |     |     |     |
| z    |     |     |     |

| Y테이블 | x   | y   | z   |
|------|-----|-----|-----|
| x    |     |     |     |
| y    | 4   | 0   | 1   |
| z    |     |     |     |

| Z테이블 | x   | y   | z   |
|------|-----|-----|-----|
| x    |     |     |     |
| y    |     |     |     |
| z    | 50  | 1   | 0   |

T1 시점 : X,와 Z는 이웃에게 자신의 테이블을 보낸다

| X테이블 | x   | y                                            | z                                    |
|------|-----|----------------------------------------------|--------------------------------------|
| x    | 0   | [C(x,y) + d(y)^y = 4],[C(x,z) + d(z)^y = 51] | [C(x,z)+d(z)^z=50],[C(x,y)+d(y)^z=5] |
| y    | 4   | 0                                            | 1                                    |
| z    | 50  | 1                                            | 0                                    |

| Y테이블 | x                                    | y   | z                                    |
|------|--------------------------------------|-----|--------------------------------------|
| x    |                                      |     |                                      |
| y    | [C(y,x)+d(y)^y=4],[C(y,z)+d(z)^x=51] | 0   | [C(y,z)+d(z)^z=1],[C(y,x)+d(x)^z=54] |
| z    |                                      |     |                                      |


| Z테이블 | x                                    | y                                    | z   |
|------|--------------------------------------|--------------------------------------|-----|
| x    |                                      |                                      |     |
| y    |                                      |                                      |     |
| z    | [C(z,x)+d(x)^x=54],[C(z,y)+d(y)^x=5] | [C(z,y)+d(y)^y=1],[C(z,x)+d(x)^y=54] | 0   |
            
T2 시점 : 바뀌는게 없으므로 안정화가 된다.          


| X테이블 | x  | y                                            | z                                    |
|------|----|----------------------------------------------|--------------------------------------|
| x    | 0  | [C(x,y) + d(y)^y = 4],[C(x,z) + d(z)^y = 51] | [C(x,z)+d(z)^z=50],[C(x,y)+d(y)^z=5] |
| y    | 4  | 0                                            | 1                                    |
| z    | 5  | 1                                            | 0                                    |


| Y테이블 | x                                   | y   | z                                   |
|------|-------------------------------------|-----|-------------------------------------|
| x    | 0                                   | 4   | 5                                   |
| y    | [C(y,x)+d(y)^y=4],[C(y,z)+d(z)^x=6] | 0   | [C(y,z)+d(z)^z=1],[C(y,x)+d(x)^z=6] |
| z    | 5                                   | 1   | 0                                   |

| Z테이블 | x                                   | y                                   | z   |
|------|-------------------------------------|-------------------------------------|-----|
| x    | 0                                   | 4                                   | 5   |
| y    | 4                                   | 0                                   | 1   |
| z    | [C(z,x)+d(x)^x=5],[C(z,y)+d(y)^x=5] | [C(z,y)+d(y)^y=1],[C(z,x)+d(x)^y=9] | 0   |


        
안정화 :

| X테이블 | x   | y   | z   |
|------|-----|-----|-----|
| x    | 0   | 4   | 5   |
| y    | 4   | 0   | 1   |
| z    | 5   | 1   | 0   |

| Y테이블 | x   | y   | z   |
|------|-----|-----|-----|
| x    | 0   | 4   | 5   |
| y    | 4   | 0   | 1   |
| z    | 5   | 1   | 0   |

| Z테이블 | x  | y   | z   |
|------|----|-----|-----|
| x    | 0  | 4   | 5   |
| y    | 4  | 0   | 1   |
| z    | 5  | 1   | 0   |


만약 x-y 의 cost가 6으로 바뀐다면?? => x와 y의 테이블 업데이트가 일어나고 이 정보를 z에게 전달한다            
T0.

| X테이블 | x  | y                                            | z                                   |
|------|----|----------------------------------------------|-------------------------------------|
| x    | 0  | [C(x,y) + d(y)^y = 6],[C(x,z) + d(z)^y = 51] | [C(x,z)+d(z)^z=5],[C(x,y)+d(y)^z=7] |
| y    | 4  | 0                                            | 1                                   |
| z    | 5  | 1                                            | 0                                   |


| Y테이블 | x                                   | y   | z                                    |
|------|-------------------------------------|-----|--------------------------------------|
| x    | 0                                   | 4   | 5                                    |
| y    | [C(y,x)+d(y)^y=6],[C(y,z)+d(z)^x=6] | 0   | [C(y,z)+d(z)^z=1],[C(y,x)+d(x)^z=11] |
| z    | 5                                   | 1   | 0                                    |

| Z테이블 | x   | y   | z   |
|------|-----|-----|-----|
| x    | 0   | 4   | 5   |
| y    | 4   | 0   | 1   |
| z    | 5   | 1   | 0   |

T1.

| X테이블 | x  | y   | z   |
|------|----|-----|-----|
| x    | 0  | 6   | 5   |
| y    | 4  | 0   | 1   |
| z    | 5  | 1   | 0   |


| Y테이블 | x   | y   | z   |
|------|-----|-----|-----|
| x    | 0   | 4   | 5   |
| y    | 6   | 0   | 1   |
| z    | 5   | 1   | 0   |

| Z테이블 | x                                    | y                                   | z   |
|------|--------------------------------------|-------------------------------------|-----|
| x    | 0                                    | 6                                   | 5   |
| y    | 6                                    | 0                                   | 1   |
| z    | [C(z,x)+d(x)^x=50],[C(z,y)+d(y)^x=7] | [C(z,y)+d(y)^y=1],[C(z,x)+d(x)^y=9] | 0   |

T2시점에는 Z가 X,Y에게 자신의 업데이트 정보를 보내고 COST가 50이 될 때까지 반복된다.                                 
                                                        
따라서 Z테이블에서  [C(z,x)+d(x)^x=5],[C(z,y)+d(y)^x=5] 업데이트 하는 경우 Y에게 이 정보를 넘겨선 안된다.               
d(z)^x가 5라는 z의 주장은 거짓이 아니라 참이다.하지만 그 경로는 z->y->x 이기 때문이다.                       
따라서 d(z)^x= INF라고 Y에게 알려준다.             
즉 T2시점에서  Y에게 Z테이블을 전달시 

| Y테이블 | x                                     | y   | z                                     |
|------|---------------------------------------|-----|---------------------------------------|
| x    | 0                                     | 4   | INF                                   |
| y    | [C(y,x)+d(y)^y=4],[C(y,z)+d(z)^x=INF] | 0   | [C(y,z)+d(z)^z=1],[C(y,x)+d(x)^z=INF] |
| z    | INF                                   | 1   | 0                                     |



